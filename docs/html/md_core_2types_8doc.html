<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.13.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Koala: Документация по core/types.h</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
  $(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Koala
   </div>
   <div id="projectbrief">Asynchronous Computing</div>
  </td>
    <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <span id="MSearchSelect"                onmouseover="return searchBox.OnSearchSelectShow()"                onmouseout="return searchBox.OnSearchSelectHide()">&#160;</span>
          <input type="text" id="MSearchField" value="" placeholder="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.13.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_core_2types_8doc.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Документация по core/types.h</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md42"></a></p>
<h1><a class="anchor" id="autotoc_md43"></a>
Описание</h1>
<p><code><a class="el" href="types_8h.html">core/types.h</a></code> содержит основные типы и структуры для кроссплатформенной работы с числами, универсальными значениями, результатами вычислений, параметрами функций и пайплайнами функций. Все типы совместимы с C и C++ и предназначены для интеграции с асинхронными примитивами (<code><a class="el" href="async_8h.html">async.h</a></code>).</p>
<hr  />
<h1><a class="anchor" id="autotoc_md45"></a>
Основные типы</h1>
<h2><a class="anchor" id="autotoc_md46"></a>
Целочисленные алиасы</h2>
<ul>
<li><code><a class="el" href="types_8h.html#a92c50087ca0e64fa93fc59402c55f8ca">u8</a></code>, <code><a class="el" href="types_8h.html#ace9d960e74685e2cd84b36132dbbf8aa">u16</a></code>, <code><a class="el" href="types_8h.html#afaa62991928fb9fb18ff0db62a040aba">u32</a></code>, <code><a class="el" href="types_8h.html#a3f7e2bcbb0b4c338f3c4f6c937cd4234">u64</a></code> — стандартные беззнаковые целые.</li>
<li><code><a class="el" href="types_8h.html#ae3702327b5f47e83b431e22b33da7b58">i8</a></code>, <code><a class="el" href="types_8h.html#ad309dbcaeea13aa602d686964156ea0b">i16</a></code>, <code><a class="el" href="types_8h.html#a48d6cd8e4135fb2ff7e7f2dac84089ec">i32</a></code>, <code><a class="el" href="types_8h.html#a85cb35fbe5bf2961d7ad5f26814a91a2">i64</a></code> — стандартные знаковые целые.</li>
<li><code><a class="el" href="types_8h.html#ae2b4f4372f3f2e9cd25737203141cffd">ufast8</a></code>, ... — быстрые целые (оптимизированы под скорость).</li>
<li><code><a class="el" href="types_8h.html#a6efcfffd6e3ec05937e7dd1e85aac269">uleast8</a></code>, ... — наименьшие целые (минимальный размер).</li>
<li><code>uptr</code>, <code>iptr</code> — для хранения указателей.</li>
<li><code>usize</code>, <code>isize</code> — для размеров и разницы указателей.</li>
</ul>
<h2><a class="anchor" id="autotoc_md47"></a>
Generic</h2>
<p>Универсальный контейнер для хранения значения любого типа.</p><ul>
<li>В C++: шаблон <code><a class="el" href="struct_generic.html">Generic</a>&lt;T&gt;</code>, поле <code>T value</code>.</li>
<li>В C: структура с полем <code>void* value</code>.</li>
<li>Макросы для C: <code><a class="el" href="types_8h.html#ac4fb7d702f5247b30f8593c9e4cd1d12">GENERIC_SET(g, v)</a></code>, <code><a class="el" href="types_8h.html#a2f0d9a4aee65152ba07520f571a68051">GENERIC_GET(type, g)</a></code>.</li>
</ul>
<h3><a class="anchor" id="autotoc_md48"></a>
Пример (C)</h3>
<div class="fragment"><div class="line"><a class="code hl_struct" href="struct_generic.html">Generic</a> g;</div>
<div class="line"><span class="keywordtype">int</span> x = 42;</div>
<div class="line"><a class="code hl_define" href="types_8h.html#ac4fb7d702f5247b30f8593c9e4cd1d12">GENERIC_SET</a>(g, &amp;x);</div>
<div class="line"><span class="keywordtype">int</span>* px = <a class="code hl_define" href="types_8h.html#a2f0d9a4aee65152ba07520f571a68051">GENERIC_GET</a>(<span class="keywordtype">int</span>*, g);</div>
<div class="line">printf(<span class="stringliteral">&quot;%d\n&quot;</span>, *px); <span class="comment">// 42</span></div>
<div class="ttc" id="astruct_generic_html"><div class="ttname"><a href="struct_generic.html">Generic</a></div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00119">types.h:119</a></div></div>
<div class="ttc" id="atypes_8h_html_a2f0d9a4aee65152ba07520f571a68051"><div class="ttname"><a href="types_8h.html#a2f0d9a4aee65152ba07520f571a68051">GENERIC_GET</a></div><div class="ttdeci">#define GENERIC_GET(type, g)</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00125">types.h:125</a></div></div>
<div class="ttc" id="atypes_8h_html_ac4fb7d702f5247b30f8593c9e4cd1d12"><div class="ttname"><a href="types_8h.html#ac4fb7d702f5247b30f8593c9e4cd1d12">GENERIC_SET</a></div><div class="ttdeci">#define GENERIC_SET(g, v)</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00124">types.h:124</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md49"></a>
Пример (C++)</h3>
<div class="fragment"><div class="line"><a class="code hl_struct" href="struct_generic.html">Generic&lt;int&gt;</a> g(42);</div>
<div class="line">std::cout &lt;&lt; g.value &lt;&lt; std::endl; <span class="comment">// 42</span></div>
<div class="line"><a class="code hl_struct" href="struct_generic.html">Generic&lt;std::string&gt;</a> gs(std::string(<span class="stringliteral">&quot;hello&quot;</span>));</div>
<div class="line">std::cout &lt;&lt; gs.value &lt;&lt; std::endl; <span class="comment">// hello</span></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md50"></a>
Result</h2>
<p>Аналог Rust <a class="el" href="struct_result.html">Result</a>: хранит либо успешное значение, либо ошибку, оба — в виде <a class="el" href="struct_generic.html">Generic</a>.</p><ul>
<li>В C++: структура с <code>bool is_ok</code>, <code><a class="el" href="struct_generic.html">Generic</a>&lt;void*&gt; ok</code>, <code><a class="el" href="struct_generic.html">Generic</a>&lt;void*&gt; err</code>.</li>
<li>В C: структура с <code>int is_ok</code>, <code><a class="el" href="struct_generic.html">Generic</a> ok</code>, <code><a class="el" href="struct_generic.html">Generic</a> err</code>.</li>
</ul>
<h3><a class="anchor" id="autotoc_md51"></a>
Пример (C)</h3>
<div class="fragment"><div class="line"><a class="code hl_struct" href="struct_result.html">Result</a> res;</div>
<div class="line"><span class="keywordtype">int</span> x = 42;</div>
<div class="line">res.<a class="code hl_variable" href="struct_result.html#a8d5e88d2fd6f6705953a4307f40b51e8">is_ok</a> = 1;</div>
<div class="line"><a class="code hl_define" href="types_8h.html#ac4fb7d702f5247b30f8593c9e4cd1d12">GENERIC_SET</a>(res.<a class="code hl_variable" href="struct_result.html#aa5c3c9431343f8dfbf1d97bdf25dcaa3">ok</a>, &amp;x);</div>
<div class="line"><span class="keywordflow">if</span> (res.<a class="code hl_variable" href="struct_result.html#a8d5e88d2fd6f6705953a4307f40b51e8">is_ok</a>) {</div>
<div class="line">    <span class="keywordtype">int</span>* px = <a class="code hl_define" href="types_8h.html#a2f0d9a4aee65152ba07520f571a68051">GENERIC_GET</a>(<span class="keywordtype">int</span>*, res.<a class="code hl_variable" href="struct_result.html#aa5c3c9431343f8dfbf1d97bdf25dcaa3">ok</a>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;%d\n&quot;</span>, *px);</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* err = <a class="code hl_define" href="types_8h.html#a2f0d9a4aee65152ba07520f571a68051">GENERIC_GET</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>*, res.<a class="code hl_variable" href="struct_result.html#a61932c0c529b3ba804174ce0461e8b3f">err</a>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;Ошибка: %s\n&quot;</span>, err);</div>
<div class="line">}</div>
<div class="ttc" id="astruct_result_html"><div class="ttname"><a href="struct_result.html">Result</a></div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00183">types.h:183</a></div></div>
<div class="ttc" id="astruct_result_html_a61932c0c529b3ba804174ce0461e8b3f"><div class="ttname"><a href="struct_result.html#a61932c0c529b3ba804174ce0461e8b3f">Result::err</a></div><div class="ttdeci">Generic err</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00186">types.h:186</a></div></div>
<div class="ttc" id="astruct_result_html_a8d5e88d2fd6f6705953a4307f40b51e8"><div class="ttname"><a href="struct_result.html#a8d5e88d2fd6f6705953a4307f40b51e8">Result::is_ok</a></div><div class="ttdeci">int is_ok</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00184">types.h:184</a></div></div>
<div class="ttc" id="astruct_result_html_aa5c3c9431343f8dfbf1d97bdf25dcaa3"><div class="ttname"><a href="struct_result.html#aa5c3c9431343f8dfbf1d97bdf25dcaa3">Result::ok</a></div><div class="ttdeci">Generic ok</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00185">types.h:185</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md52"></a>
Пример (C++)</h3>
<div class="fragment"><div class="line"><a class="code hl_struct" href="struct_result.html">Result</a> res;</div>
<div class="line"><span class="keywordtype">int</span> x = 42;</div>
<div class="line">res.<a class="code hl_variable" href="struct_result.html#a8d5e88d2fd6f6705953a4307f40b51e8">is_ok</a> = <span class="keyword">true</span>;</div>
<div class="line">res.<a class="code hl_variable" href="struct_result.html#aa5c3c9431343f8dfbf1d97bdf25dcaa3">ok</a> = <a class="code hl_typedef" href="types_8h.html#a5ac639ad8f5bb96eb3bf8279cd371c9d">Generic&lt;int*&gt;</a>(&amp;x);</div>
<div class="line"><span class="keywordflow">if</span> (res.<a class="code hl_variable" href="struct_result.html#a8d5e88d2fd6f6705953a4307f40b51e8">is_ok</a>) {</div>
<div class="line">    <span class="keywordtype">int</span>* px = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span>*<span class="keyword">&gt;</span>(res.<a class="code hl_variable" href="struct_result.html#aa5c3c9431343f8dfbf1d97bdf25dcaa3">ok</a>.<a class="code hl_variable" href="struct_generic.html#a1fbf56fa903c54bf08b9be9d7a11138e">value</a>);</div>
<div class="line">    std::cout &lt;&lt; *px &lt;&lt; std::endl;</div>
<div class="line">} <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>* err = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><span class="keywordtype">char</span>*<span class="keyword">&gt;</span>(res.<a class="code hl_variable" href="struct_result.html#a61932c0c529b3ba804174ce0461e8b3f">err</a>.<a class="code hl_variable" href="struct_generic.html#a1fbf56fa903c54bf08b9be9d7a11138e">value</a>);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Ошибка: &quot;</span> &lt;&lt; err &lt;&lt; std::endl;</div>
<div class="line">}</div>
<div class="ttc" id="astruct_generic_html_a1fbf56fa903c54bf08b9be9d7a11138e"><div class="ttname"><a href="struct_generic.html#a1fbf56fa903c54bf08b9be9d7a11138e">Generic::value</a></div><div class="ttdeci">void * value</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00120">types.h:120</a></div></div>
<div class="ttc" id="atypes_8h_html_a5ac639ad8f5bb96eb3bf8279cd371c9d"><div class="ttname"><a href="types_8h.html#a5ac639ad8f5bb96eb3bf8279cd371c9d">Generic</a></div><div class="ttdeci">struct Generic Generic</div></div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md53"></a>
FunctionParams</h2>
<p>Параметры для функций в <a class="el" href="struct_function_pipeline.html" title="Элемент цепочки функций (pipeline).">FunctionPipeline</a>.</p><ul>
<li>В C++: <code>int argc</code>, <code><a class="el" href="struct_generic.html">Generic</a>&lt;void*&gt;* argv</code>.</li>
<li>В C: <code>int argc</code>, <code>Generic* argv</code>.</li>
<li>Используется для передачи аргументов в пайплайн-функции.</li>
</ul>
<h3><a class="anchor" id="autotoc_md54"></a>
Пример (C)</h3>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> x = 1, y = 2;</div>
<div class="line"><a class="code hl_struct" href="struct_generic.html">Generic</a> argv[2];</div>
<div class="line"><a class="code hl_define" href="types_8h.html#ac4fb7d702f5247b30f8593c9e4cd1d12">GENERIC_SET</a>(argv[0], &amp;x);</div>
<div class="line"><a class="code hl_define" href="types_8h.html#ac4fb7d702f5247b30f8593c9e4cd1d12">GENERIC_SET</a>(argv[1], &amp;y);</div>
<div class="line"><a class="code hl_struct" href="struct_function_params.html">FunctionParams</a> params = { 2, argv };</div>
<div class="ttc" id="astruct_function_params_html"><div class="ttname"><a href="struct_function_params.html">FunctionParams</a></div><div class="ttdoc">Структура параметров для функций в FunctionPipeline (C).</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00209">types.h:209</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md55"></a>
Пример (C++)</h3>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> x = 1, y = 2;</div>
<div class="line"><a class="code hl_struct" href="struct_generic.html">Generic&lt;void*&gt;</a> argv[2] = { <a class="code hl_typedef" href="types_8h.html#a5ac639ad8f5bb96eb3bf8279cd371c9d">Generic&lt;void*&gt;</a>(&amp;x), <a class="code hl_typedef" href="types_8h.html#a5ac639ad8f5bb96eb3bf8279cd371c9d">Generic&lt;void*&gt;</a>(&amp;y) };</div>
<div class="line"><a class="code hl_struct" href="struct_function_params.html">FunctionParams</a> params = { 2, argv };</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md56"></a>
FunctionPipeline</h2>
<p>Элемент цепочки функций (pipeline).</p><ul>
<li>Поля: <code><a class="el" href="struct_result.html">Result</a> (*func)(FunctionParams*)</code>, <code>FunctionPipeline* next</code>.</li>
<li>Позволяет строить цепочки обработки данных.</li>
</ul>
<h3><a class="anchor" id="autotoc_md57"></a>
Пример (C)</h3>
<div class="fragment"><div class="line"><a class="code hl_struct" href="struct_result.html">Result</a> my_func(<a class="code hl_struct" href="struct_function_params.html">FunctionParams</a>* params) { <span class="comment">/* ... */</span> }</div>
<div class="line"><a class="code hl_struct" href="struct_function_pipeline.html">FunctionPipeline</a> fp = { my_func, NULL };</div>
<div class="ttc" id="astruct_function_pipeline_html"><div class="ttname"><a href="struct_function_pipeline.html">FunctionPipeline</a></div><div class="ttdoc">Элемент цепочки функций (pipeline).</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00221">types.h:221</a></div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md58"></a>
Пример (C++)</h3>
<div class="fragment"><div class="line"><a class="code hl_struct" href="struct_result.html">Result</a> my_func(<a class="code hl_struct" href="struct_function_params.html">FunctionParams</a>* params) { <span class="comment">/* ... */</span> }</div>
<div class="line"><a class="code hl_struct" href="struct_function_pipeline.html">FunctionPipeline</a> fp = { my_func, <span class="keyword">nullptr</span> };</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md60"></a>
Интеграция с async.h</h1>
<ul>
<li>Все типы совместимы с асинхронными примитивами: можно передавать <a class="el" href="struct_function_pipeline.html" title="Элемент цепочки функций (pipeline).">FunctionPipeline</a>, <a class="el" href="struct_function_params.html" title="Структура параметров для функций в FunctionPipeline (C).">FunctionParams</a>, <a class="el" href="struct_result.html">Result</a> в async_run, async_await.</li>
<li><a class="el" href="struct_generic.html">Generic</a> позволяет безопасно передавать любые типы данных между потоками.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md62"></a>
Рекомендации по памяти и безопасности</h1>
<ul>
<li>Если <a class="el" href="struct_generic.html">Generic</a> хранит указатель на динамически выделенную память, освобождайте её вручную после использования.</li>
<li>Для <a class="el" href="struct_result.html">Result</a>: если ok/err содержит динамический ресурс, освобождайте после обработки.</li>
<li><a class="el" href="struct_function_params.html#aa928a3634843ca5a3e5469b97efb4787" title="Массив аргументов (Generic)">FunctionParams::argv</a> может указывать на массив <a class="el" href="struct_generic.html">Generic</a>, который также может требовать освобождения.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md64"></a>
Расширяемость</h1>
<ul>
<li>Можно добавлять новые поля в <a class="el" href="struct_function_params.html" title="Структура параметров для функций в FunctionPipeline (C).">FunctionParams</a> для передачи контекста.</li>
<li>Можно строить сложные пайплайны, комбинируя <a class="el" href="struct_function_pipeline.html" title="Элемент цепочки функций (pipeline).">FunctionPipeline</a> через поле next.</li>
<li>Для поддержки дополнительных сценариев (например, отмена, таймауты) расширяйте <a class="el" href="struct_result.html">Result</a> и <a class="el" href="struct_function_pipeline.html" title="Элемент цепочки функций (pipeline).">FunctionPipeline</a>.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md66"></a>
Пример комплексного использования с async.h (C)</h1>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="types_8h.html">types.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="async_8h.html">async.h</a>&quot;</span></div>
<div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><a class="code hl_struct" href="struct_result.html">Result</a> sum_func(<a class="code hl_struct" href="struct_function_params.html">FunctionParams</a>* params) {</div>
<div class="line">    <a class="code hl_struct" href="struct_result.html">Result</a> res;</div>
<div class="line">    <span class="keywordtype">int</span> a = *(<span class="keywordtype">int</span>*)<a class="code hl_define" href="types_8h.html#a2f0d9a4aee65152ba07520f571a68051">GENERIC_GET</a>(<span class="keywordtype">int</span>*, params-&gt;<a class="code hl_variable" href="struct_function_params.html#aa928a3634843ca5a3e5469b97efb4787">argv</a>[0]);</div>
<div class="line">    <span class="keywordtype">int</span> b = *(<span class="keywordtype">int</span>*)<a class="code hl_define" href="types_8h.html#a2f0d9a4aee65152ba07520f571a68051">GENERIC_GET</a>(<span class="keywordtype">int</span>*, params-&gt;<a class="code hl_variable" href="struct_function_params.html#aa928a3634843ca5a3e5469b97efb4787">argv</a>[1]);</div>
<div class="line">    <span class="keywordtype">int</span>* sum = malloc(<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));</div>
<div class="line">    *sum = a + b;</div>
<div class="line">    res.<a class="code hl_variable" href="struct_result.html#a8d5e88d2fd6f6705953a4307f40b51e8">is_ok</a> = 1;</div>
<div class="line">    <a class="code hl_define" href="types_8h.html#ac4fb7d702f5247b30f8593c9e4cd1d12">GENERIC_SET</a>(res.<a class="code hl_variable" href="struct_result.html#aa5c3c9431343f8dfbf1d97bdf25dcaa3">ok</a>, sum);</div>
<div class="line">    <span class="keywordflow">return</span> res;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="milena__queue__test_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a>() {</div>
<div class="line">    <a class="code hl_struct" href="struct_async_event_loop.html">AsyncEventLoop</a>* loop = <a class="code hl_function" href="async_8h.html#a437b5a4a2f9570b7b86d002238198b3a">async_event_loop_init</a>();</div>
<div class="line">    <span class="keywordtype">int</span> x = 10, y = 20;</div>
<div class="line">    <a class="code hl_struct" href="struct_generic.html">Generic</a> argv[2];</div>
<div class="line">    <a class="code hl_define" href="types_8h.html#ac4fb7d702f5247b30f8593c9e4cd1d12">GENERIC_SET</a>(argv[0], &amp;x);</div>
<div class="line">    <a class="code hl_define" href="types_8h.html#ac4fb7d702f5247b30f8593c9e4cd1d12">GENERIC_SET</a>(argv[1], &amp;y);</div>
<div class="line">    <a class="code hl_struct" href="struct_function_params.html">FunctionParams</a> params = { 2, argv };</div>
<div class="line">    <a class="code hl_struct" href="struct_function_pipeline.html">FunctionPipeline</a> fp = { sum_func, NULL };</div>
<div class="line">    <a class="code hl_struct" href="struct_async_task.html">AsyncTask</a>* task = <a class="code hl_function" href="async_8c.html#a07b659d1096ebc8c902a9a5e63ad4925">async_run</a>(loop, &amp;fp, &amp;params);</div>
<div class="line">    <a class="code hl_struct" href="struct_result.html">Result</a> r = <a class="code hl_function" href="async_8c.html#a9be1c41fab44175790073cb7ffb83722">async_await</a>(task);</div>
<div class="line">    <span class="keywordflow">if</span> (r.<a class="code hl_variable" href="struct_result.html#a8d5e88d2fd6f6705953a4307f40b51e8">is_ok</a>) {</div>
<div class="line">        <span class="keywordtype">int</span>* sum = <a class="code hl_define" href="types_8h.html#a2f0d9a4aee65152ba07520f571a68051">GENERIC_GET</a>(<span class="keywordtype">int</span>*, r.<a class="code hl_variable" href="struct_result.html#aa5c3c9431343f8dfbf1d97bdf25dcaa3">ok</a>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Sum: %d\n&quot;</span>, *sum);</div>
<div class="line">        free(sum);</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_function" href="async_8c.html#ae9b4f6a8a99f032aab3301f145b6f4de">async_event_loop_stop</a>(loop);</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="aasync_8c_html_a07b659d1096ebc8c902a9a5e63ad4925"><div class="ttname"><a href="async_8c.html#a07b659d1096ebc8c902a9a5e63ad4925">async_run</a></div><div class="ttdeci">AsyncTask * async_run(AsyncEventLoop *loop, FunctionPipeline *func, FunctionParams *params)</div><div class="ttdoc">Запустить функцию из FunctionPipeline асинхронно через event loop.</div><div class="ttdef"><b>Definition</b> <a href="async_8c_source.html#l00101">async.c:101</a></div></div>
<div class="ttc" id="aasync_8c_html_a9be1c41fab44175790073cb7ffb83722"><div class="ttname"><a href="async_8c.html#a9be1c41fab44175790073cb7ffb83722">async_await</a></div><div class="ttdeci">Result async_await(AsyncTask *task)</div><div class="ttdoc">Ожидать завершения асинхронной задачи и получить Result.</div><div class="ttdef"><b>Definition</b> <a href="async_8c_source.html#l00158">async.c:158</a></div></div>
<div class="ttc" id="aasync_8c_html_ae9b4f6a8a99f032aab3301f145b6f4de"><div class="ttname"><a href="async_8c.html#ae9b4f6a8a99f032aab3301f145b6f4de">async_event_loop_stop</a></div><div class="ttdeci">void async_event_loop_stop(AsyncEventLoop *loop)</div><div class="ttdoc">Остановить event loop и освободить ресурсы</div><div class="ttdef"><b>Definition</b> <a href="async_8c_source.html#l00072">async.c:72</a></div></div>
<div class="ttc" id="aasync_8h_html"><div class="ttname"><a href="async_8h.html">async.h</a></div></div>
<div class="ttc" id="aasync_8h_html_a437b5a4a2f9570b7b86d002238198b3a"><div class="ttname"><a href="async_8h.html#a437b5a4a2f9570b7b86d002238198b3a">async_event_loop_init</a></div><div class="ttdeci">AsyncEventLoop * async_event_loop_init()</div><div class="ttdoc">Инициализация event loop.</div></div>
<div class="ttc" id="amilena__queue__test_8cpp_html_ae66f6b31b5ad750f1fe042a706a4e3d4"><div class="ttname"><a href="milena__queue__test_8cpp.html#ae66f6b31b5ad750f1fe042a706a4e3d4">main</a></div><div class="ttdeci">int main()</div><div class="ttdef"><b>Definition</b> <a href="milena__queue__test_8cpp_source.html#l00004">milena_queue_test.cpp:4</a></div></div>
<div class="ttc" id="astruct_async_event_loop_html"><div class="ttname"><a href="struct_async_event_loop.html">AsyncEventLoop</a></div><div class="ttdoc">Event loop для асинхронных задач с пулом потоков</div><div class="ttdef"><b>Definition</b> <a href="async_8h_source.html#l00111">async.h:111</a></div></div>
<div class="ttc" id="astruct_async_task_html"><div class="ttname"><a href="struct_async_task.html">AsyncTask</a></div><div class="ttdoc">Дескриптор асинхронной задачи (future/promise)</div><div class="ttdef"><b>Definition</b> <a href="async_8h_source.html#l00082">async.h:82</a></div></div>
<div class="ttc" id="astruct_function_params_html_aa928a3634843ca5a3e5469b97efb4787"><div class="ttname"><a href="struct_function_params.html#aa928a3634843ca5a3e5469b97efb4787">FunctionParams::argv</a></div><div class="ttdeci">Generic * argv</div><div class="ttdoc">Массив аргументов (Generic)</div><div class="ttdef"><b>Definition</b> <a href="types_8h_source.html#l00211">types.h:211</a></div></div>
<div class="ttc" id="atypes_8h_html"><div class="ttname"><a href="types_8h.html">types.h</a></div></div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md68"></a>
См. также</h1>
<ul>
<li><code><a class="el" href="async_8h.html">core/async.h</a></code> — асинхронные примитивы и event loop.</li>
<li>Doxygen-блоки с примерами внутри <a class="el" href="types_8h.html">types.h</a>.</li>
</ul>
<hr  />
<h1><a class="anchor" id="autotoc_md70"></a>
FAQ</h1>
<p><b>Q: Можно ли хранить в <a class="el" href="struct_generic.html">Generic</a> не только указатели, но и значения?</b> A: В C — только указатели (void*). В C++ можно использовать <a class="el" href="struct_generic.html">Generic&lt;T&gt;</a> для любых типов, но для совместимости с FunctionParams/Result рекомендуется использовать указатели.</p>
<p><b>Q: Как правильно освобождать память, если <a class="el" href="struct_result.html">Result</a> содержит динамический ресурс?</b> A: После обработки результата (например, после async_await) проверьте, что ok/err содержит указатель на динамический ресурс, и вызовите free или delete вручную.</p>
<p><b>Q: Можно ли передавать <a class="el" href="struct_function_params.html" title="Структура параметров для функций в FunctionPipeline (C).">FunctionParams</a> между потоками?</b> A: Да, если все данные внутри argv корректно защищены или не используются конкурентно. Для передачи больших структур используйте указатели.</p>
<p><b>Q: Как построить цепочку <a class="el" href="struct_function_pipeline.html" title="Элемент цепочки функций (pipeline).">FunctionPipeline</a>?</b> A: Каждый элемент содержит указатель на следующий. Можно динамически строить цепочки любой длины.</p>
<p><b>Q: Как интегрировать с <a class="el" href="async_8h.html">async.h</a>?</b> A: Просто передайте <a class="el" href="struct_function_pipeline.html" title="Элемент цепочки функций (pipeline).">FunctionPipeline</a> и <a class="el" href="struct_function_params.html" title="Структура параметров для функций в FunctionPipeline (C).">FunctionParams</a> в async_run. Результат получите через async_await.</p>
<hr  />
<h1><a class="anchor" id="autotoc_md72"></a>
Иллюстрированные схемы</h1>
<h2><a class="anchor" id="autotoc_md73"></a>
Generic (C)</h2>
<div class="fragment"><div class="line">+-------------------+</div>
<div class="line">|   Generic         |</div>
<div class="line">|-------------------|</div>
<div class="line">| void* value       |</div>
<div class="line">+-------------------+</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md74"></a>
Generic&lt;T&gt; (C++)</h2>
<div class="fragment"><div class="line">+-------------------+</div>
<div class="line">|   Generic&lt;T&gt;      |</div>
<div class="line">|-------------------|</div>
<div class="line">| T value           |</div>
<div class="line">+-------------------+</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md75"></a>
Result</h2>
<div class="fragment"><div class="line">+-------------------+</div>
<div class="line">|   Result          |</div>
<div class="line">|-------------------|</div>
<div class="line">| is_ok (bool/int)  |</div>
<div class="line">| ok:   Generic     |</div>
<div class="line">| err:  Generic     |</div>
<div class="line">+-------------------+</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md76"></a>
FunctionParams</h2>
<div class="fragment"><div class="line">+-------------------+</div>
<div class="line">| FunctionParams    |</div>
<div class="line">|-------------------|</div>
<div class="line">| int argc          |</div>
<div class="line">| Generic* argv     |</div>
<div class="line">+-------------------+</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md77"></a>
FunctionPipeline (цепочка)</h2>
<div class="fragment"><div class="line">+-------------------+      +-------------------+</div>
<div class="line">| FunctionPipeline  | ---&gt; | FunctionPipeline  | ---&gt; ...</div>
<div class="line">|-------------------|      |-------------------|</div>
<div class="line">| func              |      | func              |</div>
<div class="line">| next ------------+      | next ------------+</div>
<div class="line">+-------------------+      +-------------------+</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md78"></a>
Поток данных через FunctionPipeline и async</h2>
<div class="fragment"><div class="line">[FunctionParams]</div>
<div class="line">     |</div>
<div class="line">     v</div>
<div class="line">[FunctionPipeline.func] --(Result)--&gt; [async_run]</div>
<div class="line">     |                                    |</div>
<div class="line">     v                                    v</div>
<div class="line">[FunctionPipeline.next] ...         [AsyncEventLoop]</div>
<div class="line">                                         |</div>
<div class="line">                                         v</div>
<div class="line">                                    [async_await]</div>
<div class="line">                                         |</div>
<div class="line">                                         v</div>
<div class="line">                                      [Result]</div>
</div><!-- fragment --><hr  />
<h1><a class="anchor" id="autotoc_md80"></a>
Типичные ошибки и их решения</h1>
<p><b>Ошибка:</b> Использование <a class="el" href="struct_generic.html">Generic</a> для хранения значения, а не указателя (в C).</p><ul>
<li><b>Решение:</b> Всегда используйте указатель: <code>GENERIC_SET(g, &amp;x);</code> и <code><a class="el" href="types_8h.html#a2f0d9a4aee65152ba07520f571a68051">GENERIC_GET(int*, g)</a>;</code></li>
</ul>
<p><b>Ошибка:</b> Утечка памяти при использовании динамических данных в Result/Generic.</p><ul>
<li><b>Решение:</b> После обработки результата обязательно вызывайте free/delete для выделенных данных.</li>
</ul>
<p><b>Ошибка:</b> Неправильное приведение типа при извлечении из <a class="el" href="struct_generic.html">Generic</a>.</p><ul>
<li><b>Решение:</b> Убедитесь, что тип в GENERIC_GET совпадает с тем, что был сохранён.</li>
</ul>
<p><b>Ошибка:</b> Забыли инициализировать поле next в <a class="el" href="struct_function_pipeline.html" title="Элемент цепочки функций (pipeline).">FunctionPipeline</a>.</p><ul>
<li><b>Решение:</b> Всегда явно указывайте next (NULL/nullptr, если это конец цепочки).</li>
</ul>
<p><b>Ошибка:</b> Использование <a class="el" href="struct_function_params.html" title="Структура параметров для функций в FunctionPipeline (C).">FunctionParams</a> после освобождения argv.</p><ul>
<li><b>Решение:</b> Убедитесь, что argv живёт до завершения работы функции/пайплайна. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.13.2 </li>
  </ul>
</div>
</body>
</html>
