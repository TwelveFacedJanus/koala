# Milena Queue: Документация

## Описание

**Milena Queue** — это кроссплатформенная очередь задач для распределённых вычислений, реализованная на C++ с C API. Позволяет добавлять, удалять и получать задачи по индексу. Поддерживает безопасное использование в C и C++.

- Очередь реализована как динамический массив (vector) внутри C++.
- Каждая задача (`Task`) содержит имя, команду для запуска, приоритет и статус.
- Очередь (`Queue`) скрыта за opaque pointer для совместимости с C.

---

## Быстрый старт

```c
#include "milena_queue.h"

int main() {
    Queue* q = queue_create();
    Task t1 = {"Task1", "echo Hello", 1, TASK_PENDING};
    Task t2 = {"Task2", "ls -l", 2, TASK_PENDING};
    queue_append(q, &t1);
    queue_append(q, &t2);

    for (int i = 0; i < queue_size(q); ++i) {
        const Task* t = queue_get(q, i);
        printf("%s: %s\n", t->name, t->command);
    }

    queue_remove_by_index(q, 0); // удалить первую задачу
    queue_destroy(q);
    return 0;
}
```

---

## Примеры использования

### Добавление и удаление задач

```c
Queue* q = queue_create();
Task t = {"Backup", "tar -czf backup.tar.gz /data", 5, TASK_PENDING};
queue_append(q, &t);
queue_remove_by_index(q, 0);
queue_destroy(q);
```

### Получение задачи по индексу

```c
const Task* t = queue_get(q, 0);
if (t) {
    printf("%s: %s\n", t->name, t->command);
}
```

---

## Иллюстрированная схема структуры

```
+---------+      +---------+      +---------+
|  Task   | ---> |  Task   | ---> |  Task   |
|  name   |      |  name   |      |  name   |
| command |      | command |      | command |
| ...     |      | ...     |      | ...     |
+---------+      +---------+      +---------+
```

- Внутри C++ очередь реализована как std::vector<Task>.
- Для C предоставляется непрозрачный указатель (opaque pointer).

---

## Типичные ошибки при использовании

- **Использование уничтоженной очереди**
  - После `queue_destroy(q)` нельзя обращаться к `q` или задачам, полученным через `queue_get`.
- **Неверный индекс**
  - Вызов `queue_get(q, index)` или `queue_remove_by_index(q, index)` с индексом вне диапазона вернёт `NULL` или 0.
- **Передача NULL-указателей**
  - Все функции ожидают валидные указатели на очередь и задачи.

---

## FAQ

**Q: Можно ли использовать очередь из нескольких потоков?**
- Нет, реализация не потокобезопасна. Для многопоточного доступа используйте внешние механизмы синхронизации.

**Q: Как долго живут строки внутри Task?**
- Строки не копируются, а сохраняются как указатели. Убедитесь, что строки живут не меньше, чем задача в очереди.

**Q: Можно ли изменять задачи после добавления?**
- Нет, задачи внутри очереди не предназначены для изменения через полученный указатель. Для изменения — удалите и добавьте новую задачу.

**Q: Как узнать статус задачи?**
- Используйте поле `status` структуры Task, полученной через `queue_get`.

---

## Контакты и поддержка

- Вопросы и баги: создавайте issue в репозитории проекта.
- Автор: twelvefaced 